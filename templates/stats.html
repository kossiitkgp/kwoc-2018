<!--
  <body>
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">


      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Commits made</h4>
        </div>
        <div class="modal-body">
          <p>Some text in the modal.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Submit</button>
        </div>
      </div>

    </div>
  </div>
  </body>
-->

<!doctype html>
{% import 'helper_macros.html' as helpers %}
<html class="no-js" lang="en">
    <head>
        <title>Kharagpur Winter of Code | Statistics</title>
        <meta name="description" content="KWoC | Kharagpur Winter of Code">
        <meta name="keywords" content="">
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="/static/css/leaderboard-style.css">
        <link rel="shortcut icon" href="/static/images/kwoc_logo.png">
        <!-- animation -->
        <link rel="stylesheet" href="/static/css/animate.css" />
        <!-- bootstrap -->
        <link rel="stylesheet" href="/static/css/bootstrap.css" />
        <!-- et line icon -->
        <link rel="stylesheet" href="/static/css/et-line-icons.css" />
        <!-- font-awesome icon -->
        <link rel="stylesheet" href="/static/css/font-awesome.min.css" />
        <!-- revolution slider -->
        <link rel="stylesheet" href="/static/css/extralayers.css" />
        <link rel="stylesheet" href="/static/css/settings.css" />
        <!-- magnific popup -->
        <link rel="stylesheet" href="/static/css/magnific-popup.css" />
        <!-- owl carousel -->
        <link rel="stylesheet" href="/static/css/owl.carousel.css" />
        <link rel="stylesheet" href="/static/css/owl.transitions.css" />
        <link rel="stylesheet" href="/static/css/full-slider.css" />
        <!-- text animation -->
        <link rel="stylesheet" href="/static/css/text-effect.css" />
        <!-- common -->
        <link rel="stylesheet" href="/static/css/style.css" />
        <link rel="stylesheet" href="/static/css/projects.css" />
        <!-- responsive -->
        <link rel="stylesheet" href="/static/css/responsive.css" />
         <!-- Compiled and minified JavaScript -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--[if IE]>
            <link rel="stylesheet" href="/static/css/style-ie.css" />
        <![endif]-->
        <!--[if IE]>
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
    </head>
    <body>
      {{ helpers.navigation_panel() }}

      <section id="slider" class="wow fadeIn fix-background" style="background-image:url('/static/images/testimonial.jpg'); padding:120px 0 20px 0">
          <div class="opacity-full bg-dark-gray"></div>
          <div class="container">
              <div class="row">
                  <div id="owl-demo" class="col-xs-12 owl-carousel owl-theme light-pagination bottom-pagination dark-pagination-without-next-prev-arrow position-relative">
                      <!-- testimonials item -->
                      <div class="item">
                          <div class="col-md-5 col-sm-8 no-padding testimonial-style2 center-col text-center">
                              <span class="name white-text" style="font-size:2.3rem; margin:auto; padding-top: 2%;">Contribution Chart</span>
                              <p class="white-text">Contributions of students who are participating in KWoC</p>
                              <p style="color: greenyellow">NOTE: You can sort data by clicking on the table heading!</p>
                          </div>
                      </div>
                      <!-- end testimonials item -->
                      <!-- testimonials item -->

                      <!-- end testimonials item -->
                      <!-- testimonials item -->

                      <!-- end testimonials item -->
                  </div>
              </div>
          </div>
      </section>
        <!-- content section -->

        <div class="container">
            <div class="row category-dropdown">
                <div class="col-md-4">
<!--                     <select id="ddlList">
                        <option value="1">Option1</option>
                        <option value="2">Option2</option>
                        <option value="3">Option3</option>
                        <option value="4">Option4</option>
                    </select>
 -->                </div>
                <div class="col-md-6">
                    <!-- <input type="button" id="btnSort" Value=" Sort Leaderboard " /> -->
                </div>
            </div>

            <table class="table-fill" id="statTable">
            <thead>
            <tr style="cursor:pointer" >
            <th class="text-center" onclick="sortTable(0)">Name</th>
            <th class="text-center" onclick="sortTable(1)">Github Username</th>
             <th class="text-center" onclick="sortTable(2)">PRs (Closed/Open)</th>
              <th class="text-center" onclick="sortTable(3)">Commits</th>
              <th class="text-center" onclick="sortTable(4)">Lines added/removed</th>
            </tr>
            </thead>
            <tbody class="table-hover">
            {% for user, userdata in stats.items() %}
              <tr style="cursor:pointer" onclick="location.href='/stats/{{ user }}'">
              <td class="text-center" data-target="#myModal"> {{ userdata.name }} </td>
              <td class="text-center"> {{ user }} </td>
              <td class="text-center">{{ userdata.pr_closed }}/{{ userdata.pr_open }}</td>
              <td class="text-center">{{ userdata.no_of_commits }}</td>
              <td class="text-center">+{{ userdata.lines_added }} -{{ userdata.lines_removed }}</td>
            </tr>
            {% endfor %}
            </tbody>
            </table>
        </div>
        <!-- footer -->
        <footer>

            <!-- footer_final -->
            {{ helpers.end_footer() }}
            <!-- end footer -->
        </footer>
        <!-- end footer -->
        <!-- javascript libraries -->
        {{ helpers.js_libraries() }}

        <script type="text/javascript" src="/static/js/jquery.min.js"></script>
        <script type="text/javascript" src="/static/js/materialize.min.js"></script>
        <script type="text/javascript" src="/static/js/fuse.js"></script>
        <script type="text/javascript" src="/static/js/projects.js"></script>
        <script type="text/javascript" src="/static/js/modernizr.js"></script>
        <script type="text/javascript" src="/static/js/bootstrap.js"></script>
        <script type="text/javascript" src="/static/js/bootstrap-hover-dropdown.js"></script>
        <script type="text/javascript" src="/static/js/jquery.easing.1.3.js"></script>
        <script type="text/javascript" src="/static/js/skrollr.min.js"></script>
        <script type="text/javascript" src="/static/js/smooth-scroll.js"></script>
        <!-- animation -->
        <script type="text/javascript" src="/static/js/wow.min.js"></script>
        <!-- page scroll -->
        <script type="text/javascript" src="/static/js/page-scroll.js"></script>
        <!-- easy piechart-->
        <script type="text/javascript" src="/static/js/jquery.easypiechart.js"></script>
        <!-- parallax -->
        <script type="text/javascript" src="/static/js/jquery.parallax-1.1.3.js"></script>
        <!--portfolio with shorting tab -->
        <script type="text/javascript" src="/static/js/jquery.isotope.min.js"></script>
        <!-- owl slider  -->
        <script type="text/javascript" src="/static/js/owl.carousel.min.js"></script>
        <!-- magnific popup  -->
        <script type="text/javascript" src="/static/js/jquery.magnific-popup.min.js"></script>
        <script type="text/javascript" src="/static/js/popup-gallery.js"></script>
        <!-- text effect  -->
        <script type="text/javascript" src="/static/js/text-effect.js"></script>
        <!-- revolution slider  -->
        <script type="text/javascript" src="/static/js/jquery.tools.min.js"></script>
        <script type="text/javascript" src="/static/js/jquery.revolution.js"></script>
        <!-- counter  -->
        <script type="text/javascript" src="/static/js/counter.js"></script>
        <!-- fit videos  -->
        <script type="text/javascript" src="/static/js/jquery.fitvids.js"></script>
        <!-- imagesloaded  -->
        <script type="text/javascript" src="/static/js/imagesloaded.pkgd.min.js"></script>
        <!-- setting -->
        <script type="text/javascript" src="/static/js/main.js"></script>
        <!-- sorting -->
        <script>
            function sortTable(n) {
              var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
              table = document.getElementById("statTable");
              switching = true;
              // Set the sorting direction to ascending:
              dir = "asc";
              /* Make a loop that will continue until
              no switching has been done: */
              while (switching) {
                // Start by saying: no switching is done:
                switching = false;
                rows = table.rows;
                /* Loop through all table rows (except the
                first, which contains table headers): */
                for (i = 1; i < (rows.length - 1); i++) {
                  // Start by saying there should be no switching:
                  shouldSwitch = false;
                  /* Get the two elements you want to compare,
                  one from current row and one from the next: */
                  x = rows[i].getElementsByTagName("TD")[n];
                  y = rows[i + 1].getElementsByTagName("TD")[n];
                  /* Check if the two rows should switch place,
                  based on the direction, asc or desc: */
                  if (dir === "asc") {
                    if (n <= 1 && (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase())) {
                      // If so, mark as a switch and break the loop:
                      shouldSwitch = true;
                      break;
                    }

                    else if (n > 1 && (parseInt(x.innerHTML) > parseInt(y.innerHTML))) {
                      // If so, mark as a switch and break the loop:
                      shouldSwitch = true;
                      break;
                    }
                  } else if (dir === "desc") {
                    if (n<=1 && (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase())) {
                      // If so, mark as a switch and break the loop:
                      shouldSwitch = true;
                      break;
                    }
                    else if (n>1 && (parseInt(x.innerHTML) < parseInt(y.innerHTML))) {
                      // If so, mark as a switch and break the loop:
                      shouldSwitch = true;
                      break;
                    }
                  }
                }
                if (shouldSwitch) {
                  /* If a switch has been marked, make the switch
                  and mark that a switch has been done: */
                  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                  switching = true;
                  // Each time a switch is done, increase this count by 1:
                  switchcount ++;
                } else {
                  /* If no switching has been done AND the direction is "asc",
                  set the direction to "desc" and run the while loop again. */
                  if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                  }
                }
              }
            }
            sortTable(0);

			// Perform an AJAX request to fetch stats from statNum to statNum + statIncrement - 1
			function loadStatsAjax(statNum, statIncrement) {
				$.ajax({url: `stats_ajax?start=${statNum}&end=${statNum + statIncrement}`, success: result => {
					// Unpack data into table
					for ( var student in result) {
						let studentData = result[student];
						// Get table
						let table = document.getElementById('statTable');
						// Create row
						let row = table.insertRow(-1);
						row.style = 'cursor:pointer';
						row.setAttribute('onclick', `location.href='/stats/${student}'`);
						// Insert name
						let nameCell = row.insertCell(0);
						nameCell.innerHTML = studentData['name'];
						nameCell.className = 'text-center';
						nameCell.setAttribute('data-target', '#myModal');
						// Insert GitHub username 
						let gitCell = row.insertCell(1);
						gitCell.innerHTML = student;
						gitCell.className = 'text-center';
						// Insert PRs
						let prCell = row.insertCell(2);
						prCell.innerHTML = `${studentData['pr_closed']}/${studentData['pr_open']}`;
						prCell.className = 'text-center';
						// Insert Commits
						let commitCell = row.insertCell(3);
						commitCell.innerHTML = studentData['no_of_commits'];
						commitCell.className = 'text-center';
						// Insert Lines
						let lineCell = row.insertCell(4);
						lineCell.innerHTML = `+${studentData['lines_added']} -${studentData['lines_removed']}`;
						lineCell.className = 'text-center';
					};
				}});
			}

			// Check if the user has scrolled to (near) the bottom of the page
			let initStat = 100; // Load from this row onwards and increment by this many rows
			let currentStat = initStat; // currentStat
			$(window).scroll(function() {
				if($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
					loadStatsAjax(currentStat, initStat);
					currentStat += initStat;
				}
			});
        </script>
    </body>
</html>
